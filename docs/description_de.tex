\documentclass[12pt]{article}
\usepackage{acro}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{authblk}
\usepackage[ngerman]{babel}
\usepackage{booktabs}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{makecell}
\usepackage{todonotes}
\usepackage{siunitx}
\usepackage{eurosym}

%acro
\acsetup{make-links = true,}

% authblk
\renewcommand\Authand{, }
\renewcommand\Authands{, }

% babel
\addto\extrasngerman{
    \def\sectionautorefname{Abschnitt}
    \def\subsectionautorefname{Abschnitt}
    \def\subsubsectionautorefname{Abschnitt}
}

% siunitx
\DeclareSIUnit{\peak}{\textsubscript{p}}
\sisetup{locale = DE}

% acro
\DeclareAcroEnding{possessive}{}{}
\NewAcroCommand\acg{m}{\acropossessive\UseAcroTemplate{first}{#1}}
\NewAcroCommand\acsg{m}{\acropossessive\UseAcroTemplate{short}{#1}}
\NewAcroCommand\aclg{m}{\acropossessive\UseAcroTemplate{long}{#1}}
\DeclareAcronym{bdew}{short=BDEW, long=Bundesverband der Energie- und Wasserwirtschaft, possessive-form=Bundesverbandes der Energie- und Wasserwirtschaft}
\DeclareAcronym{capex}{short=CAPEX, long=investitionsbedingte Kosten\,/\,Emissionen,}
\DeclareAcronym{co2}{short=CO\textsubscript{2}, long=Kohlenstoffdioxid,}
\DeclareAcronym{dem}{short=DEM, long=Standortverbrauch,}
\DeclareAcronym{ess}{short=ESS, long=Stationärspeicher,}
\DeclareAcronym{flt}{short=FLT, long=Flotte,}
\DeclareAcronym{gcp}{short=GCP, long=Netzanschlusspunkt,}
\DeclareAcronym{gui}{short=GUI, long=grafische Benutzeroberfläche,}
\DeclareAcronym{kpi}{short=KPI, long=Leistungskennzahl, plural-form=Leistungskennzahlen}
\DeclareAcronym{lift}{short=LIFT, long=Logistics Infrastructure and Fleet Transformation,}
\DeclareAcronym{cis}{short=CIS, long=Ladeinfrastruktur,}
\DeclareAcronym{opex}{short=OPEX, long=betriebsbedingte Kosten\,/\,Emissionen,}
\DeclareAcronym{pv}{short=PV, long=Photovoltaik,}
\DeclareAcronym{pvgis}{short=PVGIS, long=Photovoltaic Geographical Information System,}
\DeclareAcronym{utc}{short=UTC, long=koordinierte Weltzeit,}


% Set page margins
\geometry{top=1in, bottom=1in, left=1in, right=1in}

\title{\textbf{LIFT}\\Logistics Infrastructure \& Fleet Transformation\\Dokumentation und Anwenderleitfaden}
\author[1]{Brian Dietermann}
\author[1]{Anna Paper}
\author[1]{Philipp Rosner}

\affil[1]{Lehrstuhl für Fahrzeugtechnik, Technische Universität München}
\date{\today}

\begin{document}

% Title page
\maketitle

% Abstract
\begin{abstract}
Das Softwaretool \acs*{lift} dient zur Unterstützung des Planungsprozesses der Elektrifizierung von Nutzfahrzeugflotten sowie des begleitenden Ausbaus des Energiesystems am dazugehörigen Depot.
Über eine grafische, webbasierte Benutzeroberfläche lassen sich der Ist-Zustand von Flotte und Depot sowie ein mögliches Elektrifizierungs- und Ausbauszenario definieren.
Basierend auf einer Energiesystem-Zeitschrittsimulation berechnet \acs*{lift} techno-ökonomische Kennzahlen für beide Szenarien und vergleicht diese.
Somit lassen sich erste Erkenntnisse über den Effekt der beabsichtigten Maßnahmen treffen und bereits eine erste Planung der Depot-Erweiterung ableiten.
Die mit \acs*{lift} erarbeitete Ersteinschätzung ist die Basis für weitere Schritte in der Detailauslegung und Realisierung eines entsprechenden Projektes.
\end{abstract}
\newpage
\tableofcontents
\printacronyms

\todo[inline]{Formelzeichen glattziehen: Sowohl den Aufbau der verwendeten Zeichen prüfen als auch deren konsitente Verwendung durch das ganze Dokument}
\todo[inline]{Berechnung/Formelzeichen für Ladeinfrastruktur/Flotte konsitent gestalten}

\todo[inline]{Standardwerte in Tabelle mit sinnvoller Formatierung überführen}

\newpage
\section{Ausgangslage und Zielsetzung}
\label{sec:target}
Das Softwaretool \ac{lift} wurde am Lehrstuhl für Fahrzeugtechnik der Technischen Universität München in Zusammenarbeit mit der Rödl GmbH entwickelt.
Es unterstützt die Elektrifizierung von Flotten und den begleitenden Ausbau des Depot-Energiesystems (inkl.~Ladeinfrastruktur) bereits in der frühen Phase mit techno-ökonomischen Potentialabschätzungen und schafft so eine Entscheidungsgrundlage für die Fortsetzung des Planungsprozesses.
Sein Zielanwendungsgebiet ist das initiale Auslegungsgespräch zwischen Kundenberater und Flottenbetreiber.
Dafür muss \ac{lift} mit wenigen, schnell abzuschätzenden oder bekannten Eingangsparametern arbeiten und die berechneten Ergebnisse schnell und intuitiv darstellen.

\ac{lift} schafft dies, indem es die Ist-Situation (\textit{Baseline}-Szenario) von Depot und Flotte mit einem möglichen Elektrifizierungs- und Ausbauplan (\textit{Expansion} Szenario) vergleichend darstellt.
Für beide wird mit den definierten Parametern jeweils eine Zeitschrittsimulation der Energieflüsse in Depot und Flotte über ein Jahr ausgeführt, auf deren Grundlage alle weiteren techno-ökonomischen Kennzahlen und der Vergleich der beiden Szenarien erstellt wird.
Um die beschriebenen Anforderungen zu erfüllen, arbeitet \ac{lift} mit Vereinfachungen und Annahmen, die in einer frühen Planungsphase der Elektrifizierung noch vertretbar sind.

Komplexere Szenarien wie aktive Flexibilitätssteuerung durch prädiktives Energiemanagement oder individuelle Mobilitätsprofile und/oder automatisierte Komponentendimensionierung erfordern dann einerseits detailliertere Daten als auch komplexere Modellierung mit mathematischer Optimierung zur Auflösung der getroffenen Vereinfachungen.
Diese Schritte sind mit anderen Werkzeugen als \ac{lift} im Nachgang des Beratungsgespräches durchzuführen.
Die Anwendung solcher Tools, die oft nicht über eine grafische Benutzeroberfläche verfügen und ggf.\,an die jeweilige Anwendung angepasst werden müssen, und vor allem die Interpretation ihrer Ergebnisse erfordert Expertenwissen und Rechenzeit.

\section{Verwendung und \acl*{gui}}
\label{sec:gui}
\ac{lift} ist in Python programmiert und verfügt über eine browserbasierte \ac{gui}, die auf der \textit{streamlit}-Bibliothek basiert.
Die Installation von \ac{lift}, entweder auf einem lokalen Rechner oder auf einem Server ist im \textit{readme} des dazugehörigen \textit{git repository} beschrieben.
Es zeigt zusätzlich, wie der Berechnungsalgorithmus von \ac{lift} losgelöst von der \ac{gui} für eine skalierbare Bewertung vieler Szenarien eingesetzt werden kann.
Dieses Dokument beschränkt sich auf die Verwendung von \ac{lift} zur Simulation einzelner Szenarien über die integrierte und in \autoref{fig:gui} dargestellte \ac{gui}.

\begin{figure}[h!]
    \centering
    \includegraphics[width=1.0\textwidth]{gui}
    \caption{Die \ac{gui} von \ac{lift} in Version 0.9.1a1 mit der linken Seitenleiste zur Eingabe der Szenario-Parameter und exemplarischer Darstellung von Ergebnissen im rechten Hauptbereich.}
    \label{fig:gui}
\end{figure}

Diese ist in zwei Bereiche aufgeteilt.
Die linke Seitenleiste dient zur Definition der Eingabeparameter für die anschließenden Berechnungen, sowie der Einstellung der anzuzeigenden Sprache (aktuell sind Deutsch und Englisch verfügbar).
Hierbei wird nach allgemeinen Parametern (Standort, Energiesystem und wirtschaftliche Kenngrößen), denen der Flotte (in vier Subklassen von Nutzfahrzeugen) und denen der Ladeinfrastruktur unterschieden.
Für jeden Eingabeparameter stehen in der \ac{gui} Hilfetexte zur genaueren Erklärung zur Verfügung, die bei Positionierung des Mauszeigers über dem jeweiligen Fragezeichensymbol erscheinen.
Die Simulation und Berechnung der Ergebnisse (siehe \autoref{sec:methods}) wird am unteren Ende der Seitenleiste ausgelöst.
Der rechte Hauptbereich der \ac{gui} visualisiert daraufhin die Ergebnisse.
Berechnete Kennwerte werden jeweils vergleichend für Baseline- und Expansions-Szenario dargestellt, um Effekte der getroffenen Maßnahmen intuitiv beurteilen zu können
Für die angezeigten Ergebnisse und Grafiken sind ebenfalls erläuternde Hilfetexte durch Bewegung des Mauszeigers über das Fragezeichensymbol verfügbar.

\section{Methodik}
\label{sec:methods}

Dieses Kapitel beschreibt den grundsätzlichen Ablauf einer Berechnung mit LIFT sowie die damit getroffenen qualitativen  bzw. methodischen Annahmen.
Quantitative Annahmen (Parameterwerte für die Einzelnutzung in der \ac{gui}) sind hingegen in \autoref{sec:defaultvalues} definiert.

\ac{lift} berechnet für \textit{Baseline}- und \textit{Expansion}-Szenario jeweils Kosten und \ac{co2}-Emissionen.
Diese lassen sich jeweils nach zwei Quellen unterscheiden: Investitionen bzw. Aufbau (\acs{capex}) und Betrieb (\acs{opex}).
Die ursprünglich ökonomischen Begriffe \ac{capex} und \ac{opex} sind im Kontext von \ac{lift} aufgrund dieser Parallelität stets gleichermaßen für Emissionen zu verstehen.

Die Szenarien modellieren jeweils ein Energiesystem, das aus mehreren Blöcken besteht, die reale Systeme abbilden (\autoref{subsec:system}).
\ac{capex} dieser Blöcke hängen unmittelbar von den Eingangsparametern ab und können daher direkt (\textit{a priori}) berechnet werden (\autoref{subsec:capex}).
In diesem Energiesystemmodell werden zu jedem simulierten Zeitschritt Leistungsflüsse heuristisch (regelbasiert) bestimmt (\autoref{subsec:sim}), deren integrierte Energieflüsse die Basis für die Berechnung von \ac{opex} im Simulationszeitraum (\autoref{subsec:opex}) und technischen \acp{kpi} (\autoref{subsec:kpi_tech}) sind.
Gesamtkosten und -emissionen werden unter Annahme von Blocklebensdauern und entsprechenden Ersatzinvestitionen sowie Kapitalkosten auf einen Projektzeitraum, der typischerweise deutlich länger als der Simulationszeitraum ist, extrapoliert (\autoref{subsec:extrapolation}) und zu ökonomischen bzw. ökologischen \acp{kpi} aggregiert (\autoref{subsec:kpi_econ}).

Dabei wird inhärent die Annahme getroffen, dass im Simulationszeitraum alle relevanten Charakteristika, z.\,B. Schwankungen in der Auslastung der Fahrzeugflotte oder bei der verfügbaren PV-Energie, abgebildet werden.
Saisonale Schwankungen sind mit einer Simulationsdauer von einem Jahr, wie sie in der \ac{gui} verwendet wird, ausreichend abgebildet.

\subsection{Energiesystemblöcke}
\label{subsec:system}

Ein modelliertes Energiesystem beinhaltet stets die folgenden Blöcke.
Sollte die Berücksichtigung eines Blocks bzw. Systems nicht gewünscht sein, dann kann dies durch entsprechende Parameterwahl (z.\,B.~$P=0$) erreicht werden.

Der \textbf{\acf{gcp}} modelliert die leistungsbeschränkte Schnittstelle zum elektrischen Netz unabhängig von dessen Spannungsebene, also die örtliche Messstelle, an der Leistungspreis und Arbeitspreis anfallen.
Der Leistungspreis wird grundsätzlich auf Jahresbasis berücksichtigt.
Bei Zeitschritten über \SI{15}{\minute} (dem realen Bemessungszeitraum des Leistungspreises) ist zu berücksichtigen, dass reale Lastspitzen über den Zeitschritt gemittelt und damit gedämpft werden.
Blindleistung im Wechselstromnetz wird nicht berücksichtigt.

Die \textbf{\ac{pv}-Anlage} modelliert ein homogen und unbeweglich für maximales Energiepotential ausgerichtetes und aufgeständertes Array von polykristallinen \ac{pv}-Modulen inklusive ihres Wechselrichters.
Das entsprechende zeitvariable Leistungspotential wird für den gewählten Standort in stündlicher Auflösung vom \ac{pvgis} der Europäischen Union für das Bezugsjahr 2023 abgerufen.
Neuere oder zeitlich feiner aufgelöste Daten sind bei diesem Anbieter nicht verfügbar.
Temperatureffekte sowie Verschattungen durch Wolken (im Bezugsjahr) oder Gelände sind berücksichtigt, Verschattungen durch Bäume und Gebäude jedoch nicht.
Die heruntergeladenen Daten für einen Standort werden zwischengespeichert und in derselben Session nicht nochmals angefordert, was die Netzwerkanforderungen bei lokaler Ausführung reduziert.

Der \textbf{\acf{ess}} modelliert einen stationären und verlustfreien Batteriespeicher mit einer maximalen Lade- und Entladeleistung (``C-Rate'') von \SI{0.5}{\per\hour} bzw. \si{C}.
Er kann also schnellstens innerhalb von \SI{2}{\hour} vollständig ge- oder entladen werden, was der Leistungsgrenze gängiger Modelle entspricht.
Alterung und limitierte nutzbare Ladezustände sind nicht berücksichtigt.

Der \textbf{\acf{dem}} modelliert den Energieumsatz der Gebäude und sonstiger Infrastruktur am Standort exklusive der vorhandenen oder aufzubauenden \acl{cis}.
Hierfür werden auszuwählende Standardlastprofile des \acg{bdew} verwendet, die auf den angegebenen jährlichen Energieverbrauch des Standorts skaliert werden.
Aufgrund ihrer stündlichen Auflösung und der ihnen zugrunde liegenden Methodik sind sie jedoch nur bedingt geeignet, einen realen Lastgang nachzubilden, da sie eine stark geglättete Charakteristik aufweisen und verfälschen die in der Simulation auftretenden Lastspitzen am \ac{gcp} gegenüber der Realität.
Im Rahmen einer Erstberatung ist diese Vereinfachung zwar nötig und zulässig, um schnell Potentiale abzuschätzen, in weiteren Planungsphasen ist davon jedoch abzuraten.

Die \textbf{\acf{cis}} modelliert mehrere (in der \ac{gui} zwei, siehe \autoref{subsubsec:default}) Klassen von Ladepunkten für Fahrzeuge, von der jeweils mehrere Ladepunkte existieren.
Die gesamte Ladeinfrastruktur unterliegt einem Lastmanagement, das statisch oder dynamisch sein kann.
Das statische Lastmanagement begrenzt in jedem Zeitschritt die für die gesamte \ac{cis} klassenübergreifend zur Verfügung stehende Ladeleistung auf einen in der \ac{gui} konstanten Wert.
Dieser wird normalerweise bestimmt, indem die Spitzenlast des Standortverbrauchs von der maximalen Leistung des Netzanschlusspunktes abgezogen wird.
Für große Simulationszeitschritte ($>\SI{15}{\minute}$) verhält sich das statische Lastmanagement nicht realistisch, da \ac{dem}-Lastspitzen, die die maximale Ladeleistung maßgeblich bestimmen, zu stark geglättet werden.
Das dynamische Lastmanagement berechnet für jeden Zeitschritt die für die Flotte zur Verfügung stehende Leistung.
Dazu wird die maximale Leistung des Netzanschlusses, die aktuell zur Verfügung stehende PV-Leistung und die maximale Leistung des Stationärspeichers unter Berücksichtigung des Ladezustands addiert und von diesem Wert der Standortverbrauch subtrahiert.
Die verbleibende Leistung steht der Ladeinfrastruktur zur Verfügung.

Die \textbf{\acf{flt}} besteht aus mehreren (in der \ac{gui} vier, siehe \autoref{subsubsec:default}) Subflotten, die jeweils Fahrzeuge des gleichen Typs und Nutzungsprofils zusammenfassen.
Dies können entweder rein verbrennungsmotorisch oder batterieelektrisch angetriebene Fahrzeuge sein, hybride Mischformen sind nicht abgebildet.
Das Mobilitätsprofil einer Subflotte beinhaltet Zeitreihen, in denen für jedes Fahrzeug die Anwesenheit am Depot sowie der Energieverbrauch von Fahrten definiert wird.
Dieses Profil ist (im Falle der \ac{gui} aus stochastischem Sampling, siehe \autoref{sec:defaultvalues}) vordefiniert und als Datei abgelegt.
Jedes Fahrzeug ist nur mit der in der Subflotte definierten Ladepunktklasse kompatibel.
Die tatsächlich maximale Ladeleistung eines Fahrzeugs entspricht dem Minimum aus in der Subflotte definierten Fahrzeugladeleistung und der in der assoziierten Ladepunktklasse definierten Leistung.
Je nach Flottengröße und \ac{cis}-Konfiguration sind sowohl die Anzahl verfügbarer Ladepunkte als auch die aktuell zur Verfügung stehende Ladeleistung eine knappe Resource.
Eine Priorisierung nach kleinster ``Flexibilitätszeit'' (Restzeit bis zum spätestmöglichen Ladebeginn, um die kommende Fahrt ohne öffentliches Laden zu erfüllen) verteilt beide Ressourcen in jedem Zeitschritt unter allen Fahrzeugen der Flotte.
Öffentliches (On-Route-) Laden wird daher nur bei unbedingter Notwendigkeit und auch in geringstmöglichem Umfang genutzt, sodass solche Fahrten mit einem Ladezustand von \SI{0}{\percent} wieder am Depot enden.
Dem Priorisierungsalgorithmus liegt die Annahme zugrunde, dass physische Ladepunkte und damit Parkplätze in jedem Zeitschritt neu verteilt werden können, was in der Realität bei kleinen Zeitschritten nicht möglich ist.

\subsection{\acs{capex}-Berechnung}
\label{subsec:capex}

Beim Aufbau jedes Blocks $b$ mit Ausnahme von \ac{DEM} entstehen ökonomische (\autoref{eq:capex_init_econ}) und ökologische (\autoref{eq:capex_init_ecol}) \ac{capex}, die mit $C^b_{cap}$ und $E^b_{cap}$ bezeichnet werden.
Für alle kontinuierlich dimensionierbaren Blöcke $b_\text{dim}$ (\ac{GCP}, \ac{PV} und \ac{ess}) werden diese jeweils in Abhängigkeit der gewählten Größe des Blocks $S^b$ sowie den spezifischen Werten pro Größeneinheit $c^b_{cap}$ und $e^b_{cap}$ berechnet.
Für die in diskrete Subblöcke aufgeteilten Blöcke $b_\text{dis}$ (\ac{cis} und \ac{flt}) ist hingegen keine Dimensionierungsabhängigkeit vorgesehen, sondern es entstehen diskrete \ac{capex} $c_{cap, m}$ pro Element $n$ (Fahrzeug oder Ladepunkt) eines Subklasse $m$ (Fahrzeug- oder Ladepunktklasse).
Diskrete Kosten $c_{cap, m}$ sind hierbei in der \ac{gui} definierbar, für spezifische Emissionen ist dies nicht vorgesehen.

\begin{subequations}
    \label{eq:capex_init}
    \begin{align}
        C_{cap, init} = & \sum_{b}{C^b_{cap}}= \sum_{b_\text{cont}}{S^b \cdot c^b_{cap}} + \sum_{b_\text{dis}}{\sum_{m,n}{c^n_{cap, m}}} \label{eq:capex_init_econ}\\
        E_{cap, init} = & \sum_{b}{E^b_{cap}} = \sum_{b_\text{cont}}{S^b \cdot e^b_{cap}} + \sum_{b_\text{dis}}{\sum_{m,n}{e^n_{cap, m}}}\label{eq:capex_init_ecol}
    \end{align}
\end{subequations}

Ersatzinvestitionen nach den parametrierten Lebensdauern werden je Block mit konstanten Nominal-\ac{capex} berücksichtigt.
Die ökonomischen \ac{capex} werden gemäß \autoref{subsec:extrapolation} diskontiert.
Mögliche Unterschiede in Lebensdauern verhindern eine sinnvolle Aggregation von \ac{capex} über Subblöcke.

\subsection{Zeitschrittsimulation und Energiemanagement}
\label{subsec:sim}

Die in \ac{lift} verwendete Zeitschrittsimulation simuliert die Energieflüsse im Energiesystem des Depots und der zugehörigen Flotte über einen gleichmäßig in Zeitschritte geteilten Simulationszeitraum.
In jedem Zeitschritt wird der addierte Leistungsbedarf von Standortverbrauches und Flotte, der mithilfe des  \ac{cis}-Lastmanagements ermittelt wird (\autoref{subsec:system}), in absteigender Priorität aus \ac{pv} (soweit zum jeweiligen Zeitpunkt verfügbar), Stationärspeicher (soweit zum jeweiligen Zeitpunkt geladen) und Netzanschluss gedeckt.
Im Fall, dass die \ac{pv} den Leistungsbedarf alleine erfüllen kann, wird der Stationärspeicher mit der durch Leistungsbeschränkung oder Ladezustand limitierten maximalen Leistung geladen.
Weitere überschüssige Leistung wird bis zur Leistungsgrenze des Netzanschlusses ins Netz eingespeist, bevor \ac{pv}-Potential abgeregelt wird.
Diese Energiemanagementstrategie wird typischerweise ``Nulllastregelung'' genannt.

Trotz des szenarioadpativen Vorgehens kann zu kleine Dimensionierung der drei Quellenblöcke in unerfüllbaren Anforderungen resultieren und eine entsprechende Fehlermeldung (``Netzanschlussfehler'') hervorrufen.
Wirkungsgrade, dynamische Strompreise und Flexibilitäten werden nicht berücksichtigt.
Die beiden letzteren Dynamiken sind mit regelbasierten Strategien nicht sinnvoll ausschöpfbar und erfordern intelligentere und situationsadaptivere Strategien wie Optimierung und/oder Machine Learning zur Steuerung.

\subsection{\acs{opex}-Berechnung}
\label{subsec:opex}

\ac{opex} fallen ausschließlich in den Blöcken \ac{gcp} und \ac{flt} an.

Am \textbf{\ac{gcp}} fallen sowohl in Abhängigkeit des Energiedurchsatzes in Bezugs- ($W^{GCP}_\text{buy}$) und Einspeiserichtung ($W^{GCP}_\text{sell}$) als auch der Spitzenlast im Simulationszeitraum ($P^{GCP}_\text{peak}$) ökonomische \ac{opex} gemäß \autoref{eq:opex_gcp} an.
Die spezifischen Kostenwerte $c^{GCP}_\text{buy}$ und $c^{GCP}_\text{sell}$ werden dabei sinngemäß positiv bzw. negativ verrechnet, obwohl letzterer in der \ac{gui} positiv definiert ist.
Alle spezifischen Kostenwerte $c^{GCP}$ sind in der \ac{gui} anpassbar.
Die ökologischen \ac{opex} bemessen sich hingegen ausschließlich nach dem Energiedurchsatz in Bezugsrichtung, da eingespeiste Energie nicht nicht mit Emissionen assoziiert wird.
Der entsprechende spezifische Emissionswert $e^{GCP}_\text{buy}$ ist nicht in der \ac{gui} anpassbar.
\todo[inline]{spezifischen Emissionswert in GUI auf Strommix anpassen und Quelle referenziern}

\begin{subequations}
    \label{eq:opex_gcp}
    \begin{align}
        C^{GCP}_{op, sim} = & \, W^{GCP}_\text{buy} \cdot c^{GCP}_\text{buy} + W^{GCP}_\text{sell} \cdot c^{GCP}_\text{sell} + P^{GCP}_\text{peak} \cdot c^{GCP}_\text{peak} \label{eq:opex_gcp_econ}\\
        E^{GCP}_{op,sim} = & W^{GCP}_\text{buy} \cdot e^{GCP}_\text{buy} \label{eq:opex_gcp_ecol}
    \end{align}
\end{subequations}

In der \textbf{\ac{flt}} muss zur Berechnung der \ac{opex} gemäß \autoref{eq:opex_flt} nach verbrennungsmotorischen Subflotten $i$ und batterieelektrischen Subflotten $j$ unterschieden werden.
Die Kosten und Emissionen der am Depot geladenen Energie für letztere sind bereits im Energiesystem bzw. \ac{gcp} erfasst und daher im Gegensatz zum öffentlichen Laden nicht der Flotte zugeordnet.

\begin{subequations}
    \label{eq:opex_flt}
    \begin{align}
        C^{FLT}_{op, sim} = & \sum_{i}{d^{i} \left(c^{i}_\text{mnt} + c^{i}_\text{toll} \cdot x^{i}_\text{toll} + c_\text{fuel} \cdot b^{i}\right)} + \sum_{j}{d^{j}} \cdot \left(c^{j}_\text{mnt} + c^{j}_\text{toll} \cdot x^{j}_\text{toll}\right) + {W^{j}_\text{pub} \cdot c_\text{pub}}\\
        E^{FLT}_{op,sim} = & \sum_{i}{d^{i} \cdot b^{i} \cdot e_\text{fuel}} + \sum_{j}{W^{j}_\text{pub} \cdot e^{GCP}_\text{buy}} \label{eq:opex_flt_ecol}
    \end{align}
\end{subequations}

Dabei bezeichnen *$d^{i/j}$ die gefahrene Distanz aller Fahrzeuge der Subflotte $i$ oder $j$, $c^{i/j}_\text{mnt}$ ihre spezifischen Wartungskosten pro Kilometer, $c^{i/j}_\text{toll}$ ihre spezifischen Mautkosten pro Kilometer, *$x^{i/j}_\text{toll}$ ihren Anteil der mautpflichtigen Strecken, *$c_\text{fuel}$ die spezifischen Dieselkosten pro Liter, $b^i$ ihren spezifischen Kraftstoffverbrauch \si{\liter\per\kilo\meter}, $W^{j}_\text{pub}$ die öffentlich geladenene Energie aller Fahrzeuge der Subflotte $j$ und *$c_\text{pub}$ die öffentlichen Ladekosten pro \si{\kilo\watt\hour}.
Die mit * markierten Werte sind in der \ac{gui} einstellbar.
Für die spezifischen Emissionen des öffentlichen Ladens wird der Wert des Standortes verwendet.

\subsection{Technische \acp{kpi}}
\label{subsec:kpi_tech}

Die technischen \acp{kpi} werden über den Simulationszeitraum berechnet und dienen als Anhaltspunkt, ob sich die definierten Größen für \ac{gcp}, \ac{pv} und \ac{ess} sowie die gewählte Ladeinfrastruktur in einem für das System vorteilhaften Rahmen bewegen.
Dabei wird die lokal genutzte Energie $W^{cons}_\text{sim}$ gemäß \autoref{eq:energy_consumption} als die in \ac{dem} und \ac{flt} abgeflossene Energie definiert.
Sinngemäß sind alle anderen Energieabflüsse, also das abgeregelte \ac{PV}-Energiepotential $W^{PV}_\text{curt,sim}$ und die am \ac{gcp} eingespeiste Energie $W^{GCP}_\text{sell}$ als extern genutzt zu werten.

\begin{subequations}
    \label{eq:energy_boundaries}
    \begin{align}
        W^{loc}_\text{sim} = & W^{FLT}_\text{dep, sim} + W^{DEM}_\text{sim} \label{eq:cons_loc} \\
        W^{ext}_\text{sim} = & W^{PV}_\text{curt,sim} + W^{GCP}_\text{sell} \label{eq:cons_ext}
    \end{align}
\end{subequations}

\todo[inline]{$W^{FLT}_\text{sim}$ ist nicht gut genug von externem Laden abgegrenzt}

Die \textbf{Eigenverbrauchsquote} $\gamma_{sc}$ gemäß \autoref{eq:selfconsumption} gibt an, welcher Anteil des \ac{pv}-Energiepotentials lokal genutzt wurde.
Dies kann entweder direkt oder auch indirekt über die extern genutzte Energie berechnet werden
Sowohl sehr geringe als auch eine sehr hohe Werte von $\gamma_{sc}$  sind nicht vorteilhaft: Erstere deuten auf eine überdimensionierte, letztere auf eine unterdimensionierte \ac{pv}-Anlage hin.

\begin{equation}
    \gamma_{sc} = \frac{W^{loc}_\text{sim}}{W^{PV}_\text{pot}} = 1 - \frac{W^{ext}_\text{sim}}{W^{PV}_\text{pot}}
    \label{eq:selfconsumption}
\end{equation}\\

Der \textbf{Autarkiegrad} $\gamma_{ss}$ gemäß \autoref{eq:selfsufficiency} gibt an, welcher Anteil der lokal genutzten Energie auch lokal bzw. aus \ac{pv} bereitgestellt wurde.
Ein sehr hoher Autarkiegrad deutet auf eine für den Verbrauch am Standort aus ökonomischer Sicht zu überdimensionierte Kombination aus \ac{pv} und \ac{ess} hin.

\begin{equation}
    \gamma_{ss} = \frac{W^{PV}_\text{pot, sim} - W^{PV}_\text{curt} - E^{GCP}_\text{sell}}{W^{loc}_\text{sim}}
    \label{eq:selfsufficiency}
\end{equation}

Der \textbf{Depotladegrad} $\gamma_{ch}$ gemäß \autoref{eq:homecharging} gibt an, welcher Energieanteil über die gesamte \ac{FLT} am Depot geladen wurde.
Ein sehr geringer Wert deutet auf Limitationen durch Ladepunkt- oder Ladeleistungsverfügbarkeit.
Für letztere können die Dimensionierungen von \ac{cis} und\,/\,oder \ac{gcp} ursächlich sein.
Da die lokalen Energiekosten im Vergleich zum öffentlichen Laden meist geringer ausfallen, ist hier ein möglichst hoher Wert anzustreben.

\begin{equation}
    \gamma_{ch} = \frac{W^{FLT}_\text{dep, sim}}{W^{FLT}_\text{dep, sim} + W^{FLT}_\text{pub, sim}}
    \label{eq:homecharging}
\end{equation}

Es sei darauf hingewiesen, dass diese \acp{kpi} stark an Aussagekraft einbüßen, sobald Wirkungsgrade und größere Dynamiken wie bidirektionales Laden und dynamische Netzbezugskosten hinzukommen.

\subsection{Extrapolation}
\label{subsec:extrapolation}

Zur Berechnung von \ac{capex} und \ac{opex} über den Projektzeitraum müssen die Ergebnisse des Simulationszeitraums extrapoliert und im Falle von Kosten dabei diskontiert werden.
\ac{capex} treten gemäß \autoref{eq:extrapolation_capex} jeweils bei Anfangs- und Ersatzinvestitionen $i$ eines Blocks $b$ entsprechend seiner Lebensdauer $ls^b$ auf, werden in der Diskontierung mit dem Kapitalkostensatz $r$ zu Beginn eines Projektjahres angenommen und werden über alle Blöcke addiert.
Anfangsinvestitionen bei $t=0$ werden dementsprechend effektiv nicht diskontiert.
Der Restwert $C^b_{res}$ jedes Blocks zum Ende des Projektzeitraumes wird sinngemäß als negative Kosten verrechnet und verhindert Sprungeffekte in den Ergebnissen bei Variation diskreter Parameter wie Lebensdauern.
Der Wertverlust wird als linear über die Lebensdauer angenommen.

\begin{subequations}
    \label{eq:extrapolation_capex}
    \begin{align}
        C_\text{cap, prj} = & \sum_{b}{ \left( \left( \sum_{i}{\frac{C^b_\text{cap}}{\left(1 + r\right)^{t(i)}}} \right) - C^b_{\text{res}}} \right) , \quad t(i) \in n \cdot ls^b, n \in \left\{x \in \mathbb{N}_0 \vert x \leqq \left\lfloor\frac{t_\text{prj}}{ls^b}\right\rfloor\right\}\label{eq:extrapolation_capex_econ}\\
        C^{b}_\text{res} = & \begin{cases}
    C^b_\text{cap} \cdot \left( 1 - \frac{(t_\text{prj} \bmod ls^b)}{ls^b} \right) & \text{if } t_{prj} \bmod ls^b \neq 0 \\
    0 & \text{if } t_{prj} \bmod ls^b = 0
    \end{cases}
    \label{eq:extrapolation_capex_residual}\\
        E_\text{cap, prj} = & \sum_{b}{\sum_{i}{E^b_\text{cap}}} \label{eq:extrapolation_capex_ecol}
    \end{align}
\end{subequations}

Im Gegensatz dazu werden \ac{opex} des Simulationszeitraumes gemäß \autoref{eq:extrapolation_opex} zunächst linear auf ein Jahr skaliert und angenommen, dass jedes Jahr $y \in \left\{x \in \mathbb{N}_0 \vert x < t_\text{prj} \right\}$ des Projektzeitraumes diesem skalierten Jahr entspricht und \ac{opex} am Ende dieses Jahres auftreten.
Ökonomische \ac{opex} werden daher mit dem Exponenten $y+1$ diskontiert.

\begin{subequations}
    \label{eq:extrapolation_opex}
    \begin{align}
        C_\text{op, prj} = & \sum_{b}{\sum_{y}{\frac{C^{GCP}_\text{op, sim} + C^{FLT}_\text{op, sim}}{t_\text{sim, y} \left(1 + r\right)^{y+1}}}} \label{eq:extrapolation_opex_econ}\\
        E_\text{op, prj} = & \sum_{b}{\sum_{y}{\frac{E^{GCP}_\text{op, sim} + E^{FLT}_\text{op, sim}}{t_\text{sim, y}}}} \label{eq:extrapolation_opex_ecol}
    \end{align}
\end{subequations}

\subsection{Ökonomische und ökologische \acp{kpi}}
\label{subsec:kpi_econ}

Die summarischen Berechnungen in \autoref{subsec:extrapolation} werden in \ac{lift} tatsächlich vektorisiert und somit nach Jahren aufgeschlüsselt durchgeführt.
So kann die Investition

% Amortisationszeit

\section{Parameter und Standardwerte}
\label{sec:defaultvalues}

\todo[inline]{Standardwerte in gleicher Spalte mit Quellen belegen}
\todo[inline]{Alle (auch GUI-) Parameter in Tabelle integrieren}

\begin{table}[!hbt]
\centering
\makebox[\linewidth]{
\begin{tabular}{rlll}
\toprule
\textbf{Formelz.} & \textbf{Parameter} & \textbf{Einheit} & \textbf{\ac{gui}-Wert}\\
\midrule
\textbf{Simulation}\\
$t_{sim}^{start}$ & Startzeit der Simulation & keine & \makecell[l]{01.01.2023 00:00\\(\acs{utc}+01:00)}\\
\makecell[r]{$t_{sim}$\\$t_{si, y}$} & Simulationszeitraum & \makecell[l]{Tage\\Jahre} & \makecell[l]{365 Tage\\1 Jahr}\\
$T^{sim}_{Zeitschritt}$ & Simulationszeitschritt & Stunde & 1 Stunde\\
\midrule
\textbf{Netzanschluss}\\
\midrule
\textbf{\ac{pv}-Anlage}\\
\midrule
\textbf{Stationärspeicher}\\
\midrule
\textbf{Ladeinfrastruktur}\\
\midrule
\textbf{Flotte}\\
\midrule
\bottomrule
\end{tabular}
}
\caption{Parameterdefinition, Formelzeichen und Standardwerte mit Quellenangabe in \ac{lift}. Wenn kein \ac{gui}-Wert angegeben ist, dann ist dieser Parameter in der GUI anpassbar.}
\label{tab:parameters}
\end{table}

\subsection{Blöcke}
\label{subsec:default_components}
\subsubsection{Netzanschluss}
\label{subsubsec:default_grid}
$c^{Netz}_{Invest}$: 200 €/kW\\
$co2^{Netz}_{Invest}$: 0,0 kg/kW\\
$co2^{Netz}_{Betrieb}$: 0.400 kg/kWh\\
$ls^{Netz}$: 18 Jahre\\

\subsubsection{PV-Anlage}
\label{subsubsec:default_pv}
$c^{PV}_{Invest}$: 900 €/kWp\\
$co2^{PV}_{Invest}$: 798,0 kg/kWp\\
$ls^{PV}$: 18 Jahre\\

\subsubsection{Stationärspeicher}
\label{subsubsec:default_ess}
$c^{Speicher}_{Invest}$: 450 €/kWh\\
$co2^{Speicher}_{Invest}$: 69,0 kg/kWh\\
$ls^{Speicher}$: 9 Jahre\\

\subsubsection{Ladeinfrastruktur}
\label{subsubsec:default_ci}
\textbf{AC-Ladepunkte}\\
$CO2^{Ladepunkt, AC}_{Invest}$: 65,4 kg\\
$ls^{SLadepunkt, AC}$: 6 Jahre\\

\textbf{DC-Ladepunkte}\\
$CO2^{Ladepunkt, DC}_{Invest}$: 6520 kg\\
$ls^{SLadepunkt, DC}$: 6 Jahre\\

\subsubsection{Flotte}
$co2^{Diesel}$: 3,08 kg CO2-eq./l\\

\label{subsubsec:default_fleet}
\textbf{Schwere Lkw}\\
$S_{Batterie}$: 480 kWh\\
$CO2^{Fahrzeug, BEV}_{Invest}$: 84600 kg\\
$CO2^{Fahrzeug, ICEV}_{Invest}$: 54000 kg\\
$c^{BEV}_{Maut}$: 0,0 €/km\\
$c^{ICEV}_{Maut}$: 0,269 €/km\\
$c^{BEV}_{Wartung}$: 0,1324 €/km\\
$c^{ICEV}_{Wartung}$: 0,185 €/km\\
$v^{ICEV}$: 27 l/100km\\
$ls$: 6 Jahre\\

\textbf{Schwerer Verteilverkehr}\\
$S_{Batterie}$: 400 kWh\\
$CO2^{Fahrzeug, BEV}_{Invest}$: 59000 kg\\
$CO2^{Fahrzeug, ICEV}_{Invest}$: 31200 kg\\
$c^{BEV}_{Maut}$: 0,0 €/km\\
$c^{ICEV}_{Maut}$: 0,242 €/km\\
$c^{BEV}_{Wartung}$: 0,1324 €/km\\
$c^{ICEV}_{Wartung}$: 0,185 €/km\\
$v^{ICEV}$: 23 l/100km\\
$ls$: 6 Jahre\\

\textbf{Urbaner Verteilverkehr}\\
$S_{Batterie}$: 160 kWh\\
$CO2^{Fahrzeug, BEV}_{Invest}$: 26700 kg\\
$CO2^{Fahrzeug, ICEV}_{Invest}$: 16200 kg\\
$c^{BEV}_{Maut}$: 0,0 €/km\\
$c^{ICEV}_{Maut}$: 0,137 €/km\\
$c^{BEV}_{Wartung}$: 0,1051 €/km\\
$c^{ICEV}_{Wartung}$: 0,1577 €/km\\
$v^{ICEV}$: 19 l/100km\\
$ls$: 6 Jahre\\

\textbf{Lieferwagen}\\
$S_{Batterie}$: 81 kWh\\
$CO2^{Fahrzeug, BEV}_{Invest}$: 13870 kg\\
$CO2^{Fahrzeug, ICEV}_{Invest}$: 8622 kg\\
$c^{BEV}_{Maut}$: 0,0 €/km\\
$c^{ICEV}_{Maut}$: 0,0 €/km\\
$c^{BEV}_{Wartung}$: 0,0275 €/km\\
$c^{ICEV}_{Wartung}$: 0,0339 €/km\\
$v^{ICEV}$: 15 l/100km\\
$ls$: 6 Jahre\\

\section{Quellen}
\bibliographystyle{plain}
\bibliography{references}

\listoftodos

\end{document}
